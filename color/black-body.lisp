(in-package :nineveh.color)

(defun-g blackbody ((temp :float))
 (let* ((col (v3! 255.0)))
   (setf (x col) (+ (* "56100000" (pow temp (/ (- 3.0) 2.0))) "148.0"))
   (setf (y col) (- (* "100.04" (log temp)) "623.6"))
   (when (> temp "6500.0")
     (setf (y col) (+ (* "35200000" (pow temp (/ (- 3.0) 2.0))) "184.0")))
   (setf (z col) (- (* "194.18" (log temp)) "1448.6"))
   (setf col (/ (alexandria.0.dev:clamp col 0.0 255.0)
                255.0))
   (when (< temp 1000.0)
     (varjo::multf col (/ temp 1000.0)))
   col))
